{"version":3,"sources":["components/Header/logo_aviasales.svg","components/WaitingTimer/index.js","components/Header/index.js","components/Filter/index.js","components/Sidebar/index.js","components/Tabs/index.js","components/Flight/FlightOrigDest/index.js","components/Flight/FlightStops/index.js","components/Flight/FlightDuration/index.js","components/Flight/index.js","components/Ticket/index.js","components/TicketList/index.js","components/Main/index.js","index.js"],"names":["module","exports","WaintingTimer","className","Header","src","logo","alt","style","width","Filter","props","content","Object","entries","filters","sort","a","map","item","index","filterName","filterStatus","key","type","id","checked","onChange","e","handleClick","htmlFor","renderFilterItems","all","0","1","2","3","Sidebar","Tabs","onClick","data-sorter","FlightStops","segment","origin","destination","timeTakeoff","minutesDuration","start","Date","end","parse","stH","getHours","stM","getMinutes","endH","endM","getTakeoffLandingTime","date","duration","arr","length","describeStops","stops","i","minutes","h","parseInt","m","Math","round","getDuration","Flight","details","Ticket","ticketInfo","price","carrier","segments","TicketList","ticketsArray","Main","state","allowRender","_buf","this","askServer","setState","prevProps","url","URL","entryPath","searchPath","getSearchID","path","console","group","log","getTicketList","ticketsAll","rawFiltered","targetFilters","filter","ticket","includes","getMaxStops","resultTicketList","cheapest","fastest","groupEnd","Component","max","fetch","then","res","json","searchId","store","stop","warn","fetchTicketPack","pack","push","tickets","req","status","slice","b","reduce","prev","App","_timeoutBeforeSearch","handleSearchParams","bufferingDecorator","ms","bufferTimer","animTimer","TIMEOUT_TO_SETSTATE","SAVED_THIS","buffer","assign","clearTimeout","currentTarget","classList","contains","target","dataset","sorter","cssClass","querySelector","remove","add","highlightTabs","getCorrectFilters","watchingCheckbox","setTimeout","highlightBuffered","bufferAnim","document","animTip","FILTERS","filterID","every","st","values","some","hasOwnProperty","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.c66f4756.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo_aviasales.0c089234.svg\";","import React from 'react'\nimport './style.css'\n\nexport default function WaintingTimer() {\n  return (\n    <>\n      <p className=\"timeout__tip\">Ожидание ввода...</p>\n      <div className='timeout'></div>\n    </>\n  );\n}","import React from 'react'\nimport logo from './logo_aviasales.svg'\n\nexport default function Header() {\n  return (\n    <div className=\"logo center\">\n      <img src={logo} alt='Aviasales logo' style={{ width: '82px' }} />\n    </div>\n  );\n}","import React from 'react'\nimport './style.css'\n\nexport default function Filter(props) {\n  const _filterText = {\n    all: 'Все',\n    0: 'Без пересадок',\n    1: '1 пересадка',\n    2: '2 пересадки',\n    3: '3 пересадки'\n  }\n  return (\n    <form className=\"form filter\">\n      <h3 className=\"form__header\">Количество пересадок</h3>\n      {renderFilterItems(props, _filterText)}\n    </form>\n  );\n}\nfunction renderFilterItems(props, content) {\n  // WARN: вариант без сортировки?\n  const FILTER_RAW = Object.entries(props.filters).sort(a => -(a[0] === 'all'));\n  return FILTER_RAW.map((item, index) => {\n    const [filterName, filterStatus] = item;\n    return (\n      <div className=\"filter__item\" key={index}>\n        <input className=\"filter__input\" type=\"checkbox\"\n          id={filterName}\n          checked={filterStatus}\n          onChange={(e) => handleClick(e, props)}\n        />\n        <label className=\"filter__label\" htmlFor={filterName}>\n          {content[filterName]}\n        </label>\n      </div>\n    )\n  })\n}\nfunction handleClick(e, props) {\n  props.onChange(e);\n}","import React from 'react'\nimport Filter from '../Filter'\n\nexport default function Sidebar(props) {\n  return (\n    <div className=\"card row__col-side\">\n      <Filter\n        filters={props.filters}\n        onChange={props.onChange}\n      />\n    </div>\n  );\n}","import React from 'react'\nimport './style.css'\n\nexport default function Tabs(props) {\n  return (\n    <ul className=\"tabs card\" onClick={(e) => handleClick(e, props)}>\n      <li data-sorter=\"cheapest\" className=\"tabs__item tabs__item_active\">Самый дешевый</li>\n      <li data-sorter=\"fastest\" className=\"tabs__item\">Самый быстрый</li>\n    </ul>\n  );\n}\nfunction handleClick(e, props) {\n  props.onClick(e);\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">\n        {`${props.segment.origin} - ${props.segment.destination}`}\n      </span>\n      <span className=\"fw-bold\">\n        {getTakeoffLandingTime(props.segment.date, props.segment.duration)}\n      </span>\n    </div>\n  );\n}\nfunction getTakeoffLandingTime(timeTakeoff, minutesDuration) {\n  const start = new Date(timeTakeoff);\n  const end = new Date(Date.parse(timeTakeoff) + minutesDuration * 60 * 1000);\n\n  const stH = start.getHours()    < 10 ? '0' + start.getHours()   : start.getHours();\n  const stM = start.getMinutes()  < 10 ? '0' + start.getMinutes() : start.getMinutes();\n  const endH = end.getHours()     < 10 ? '0' + end.getHours()     : end.getHours();\n  const endM = end.getMinutes()   < 10 ? '0' + end.getMinutes()   : end.getMinutes();\n\n  return `${stH}:${stM} - ${endH}:${endM}`;\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">\n        {describeStops(props.stops)}\n      </span>\n      <span className=\"fw-bold\">\n        {props.stops.map((item, i) => i > 0 ? ', '+item : item)}\n      </span>\n    </div>\n  );\n}\nfunction describeStops(arr) {\n  switch (arr.length) {\n    case 1: return '1 пересадка';\n    case 2: return '2 пересадки';\n    case 3: return '3 пересадки';\n    default: return 'Без пересадок';\n  }\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">В пути</span>\n      <span className=\"fw-bold\">\n        {getDuration(props.duration)}\n      </span>\n    </div>\n  );\n}\nfunction getDuration(minutes) {\n  const h = parseInt(minutes / 60);\n  const m = Math.round((minutes / 60 - h) * 60);\n  return `${h}ч ${m}м`;\n}","import React from 'react'\nimport FlightOrigDest from './FlightOrigDest'\nimport FlightStops from './FlightStops'\nimport FlightDuration from './FlightDuration'\n\nexport default function Flight(props) {\n  return props.details.map((segment, i) => {\n    return (\n      <div key={i} className=\"flight row\">\n        <FlightOrigDest segment={segment} />\n        <FlightDuration duration={segment.duration} />\n        <FlightStops stops={segment.stops} />\n      </div>\n    );\n  })\n}","import React from 'react';\nimport './style.css';\nimport Flight from '../Flight'\n\nexport default function Ticket(props) {\n  return (\n    <div className=\"card ticket\">\n      <div className=\"row row_btwn\">\n        <span className=\"price\">\n          {props.ticketInfo.price} Р\n          </span>\n        <div className=\"logo-iata\">\n          <img\n            src={`http://pics.avs.io/99/36/${props.ticketInfo.carrier}.png`}\n            alt={props.ticketInfo.carrier} />\n        </div>\n      </div>\n      <Flight details={props.ticketInfo.segments} />\n    </div>\n  );\n}","import React from 'react'\nimport Ticket from '../Ticket'\n\nexport default function TicketList(props) {\n  if (!props.ticketsArray) {\n    return <p className='row'>Загрузка билетов</p>;\n  }\n  return (\n    <div className='tickets'>\n      {props.ticketsArray.map((item, i) => <Ticket ticketInfo={item} key={i} />)}\n    </div>\n  );\n\n}","import React, { Component } from 'react'\n\nimport Tabs from '../Tabs'\nimport TicketList from '../TicketList'\n\nexport default class Main extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      allowRender: false,\n      _buf: null\n    }\n  }\n  render() {\n    return (\n      <div className=\"main row__col-main\">\n        <Tabs onClick={this.props.onClick} />\n        <TicketList\n          ticketsArray={this.state._buf}\n        />\n      </div>\n    )\n  }\n  // static getDerivedStateFromProps(props, state) {\n  //   if (props.filters !== state.filters && props.filters !== undefined && props.sort !== state.sort && props.sort !== undefined) {\n  //     return {sort: props.sort, filters: props.filters, allowRender: false}\n  //   }\n  //   return null;\n  // }\n  async componentDidMount() {\n    let a = await this.askServer(this.props.sort);\n    this.setState(state => { return { allowRender: true, _buf: a } })\n  }\n  async componentDidUpdate(prevProps) {\n    if (\n      prevProps !== this.props\n    ) {\n      this.setState(() => { return { allowRender: false, _buf: null } })\n      let a = await this.askServer(this.props.sort);\n      this.setState(() => { return { allowRender: true, _buf: a } })\n    }\n  }\n  // componentWillUnmount() {\n  //   this.setState(state => {return {allowRender: false, _buf: null}})\n  // }\n  async askServer(sort = this.props.sort, filters = this.props.filters) {\n    let url = new URL('https://front-test.beta.aviasales.ru');\n    let entryPath = new URL('/search', url);\n    let searchPath = new URL('/tickets?searchId=', url);\n    let id = await getSearchID(entryPath);\n    const path = searchPath + id;\n    console.group('получаем новые билеты...');\n    console.log('search ID: ' + id + ', URL:', path);\n    // получаем ВСЕ билеты\n    let ticketsAll = await getTicketList(path);\n    // ФИЛЬТР\n    let rawFiltered = [];\n    if (filters.all === true) {\n      rawFiltered = ticketsAll;\n    } else {\n      // Возвращает массив чисел, которые означают нужное количество пересадок.\n      let targetFilters = Object.entries(filters)\n        .filter(item => item[0] !== 'all')\n        .filter(item => item[1] === true)\n        .map(item => +item[0]);\n      // Если билет содержит хоть одно число из массива, то билет успешно проходит фильтр\n      // удовлетворяет ли ticket.stops фильтрам (от 1 до 4 одновременно) из пропсов\n      // WARN: если активны все 4, то лишняя обработка, т.к 4 фильтра === 1 фильтр 'all'\n      rawFiltered = ticketsAll.filter(ticket => targetFilters.includes(getMaxStops(ticket)));\n    }\n    // СОРТ + урезает до 5\n    let resultTicketList = sort === \"cheapest\" ?\n      cheapest(rawFiltered) :\n      fastest(rawFiltered);\n\n    console.groupEnd();\n\n    // this.setState(state => {\n    //   const t = Object.assign({}, state); \n    //   t.tickets = resultTicketList;\n    //   return t;\n    // });\n    return await resultTicketList;\n  }\n\n}\nfunction getMaxStops(ticket) {\n  return Math.max(ticket.segments[0].stops.length, ticket.segments[1].stops.length);\n}\nfunction getSearchID(url) {\n  return fetch(url)\n    .then(res => res.json())\n    .then(json => json.searchId);\n}\nasync function getTicketList(url) {\n  let store = [];\n  for (let stop = false, i = 0; stop !== true && i < 100; i += 1) {\n    if (i === 100) {\n      console.warn('СЧЕТЧИК', i)\n    }\n    let pack = await fetchTicketPack(url);\n    stop = pack.stop;\n    store.push(...pack.tickets);\n    if (stop) {\n      console.warn('searching success! stop:', pack.stop, ', count of tickets:', store.length);\n    }\n  }\n  return store;\n}\nasync function fetchTicketPack(url) {\n  let req = await fetch(url);\n  if (req.status === 500) {\n    return await fetchTicketPack(url);\n  }\n  return await req.json();\n}\nfunction cheapest(tickets) {\n  return tickets\n    .slice()\n    .sort((a, b) => a.price - b.price)\n    .slice(0, 5);\n}\nfunction fastest(tickets) {\n  return tickets\n    .slice()\n    .sort((a, b) => {\n      return a.segments.reduce((prev, item) => prev.duration + item.duration)\n        -\n        b.segments.reduce((prev, item) => prev.duration + item.duration);\n    })\n    .slice(0, 5);\n}\n\n\n\n\n","import React, { Component } from 'react'\nimport ReactDOM from 'react-dom'\n\nimport './style.css'\n\nimport WaitingTimer from './components/WaitingTimer'\nimport Header from './components/Header'\nimport Sidebar from './components/Sidebar'\nimport Main from './components/Main'\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      sort: \"cheapest\",\n      filters: {\n        all: true,\n        0: false,\n        1: false,\n        2: false,\n        3: false\n      },\n    }\n  }\n  render() {\n    let handleSearchParams = this.bufferingDecorator(this._timeoutBeforeSearch);\n    return (\n      <div className='container'>\n        <WaitingTimer />\n        <div className=\"row\">\n          <Header />\n        </div>\n        <div className=\"row\">\n          <Sidebar\n            filters={this.state.filters}\n            onChange={handleSearchParams}\n          />\n          <Main\n            onClick={handleSearchParams}\n            filters={this.state.filters}\n            sort={this.state.sort}\n          />\n        </div>\n      </div>\n    )\n  }\n  // -----------------------\n  _timeoutBeforeSearch = 2000;\n  // Это замыкание даёт время юзеру прокликать все нужные контролы,\n  // и только потом запросить билеты с сервера.\n  // Зачем: плохо дёргать сервер на каждое движение пользователя =>\n  // => надо поменьше писать в стейт, как вариант.\n  bufferingDecorator(ms) {\n    const TIMEOUT_TO_SETSTATE = ms;\n    const SAVED_THIS = this;\n    let buffer = Object.assign({}, this.state);\n    // Таймеры объяв-ся здесь для сброса первым делом, если это не 1й клик\n    let bufferTimer;\n    let animTimer;\n    return function (e) {\n      clearTimeout(bufferTimer);\n      clearTimeout(animTimer);\n      // Перезапись буфера новым состоянием контролов на момент клика\n      if (e.currentTarget.classList.contains('tabs')) {\n        buffer.sort = e.target.dataset.sorter;\n        highlightTabs(e);\n      } else {\n        buffer.filters = SAVED_THIS.getCorrectFilters(e);\n        highlightBuffered(e, TIMEOUT_TO_SETSTATE)\n      }\n      // запуск анимации ожидания\n      let bufferAnim = document.querySelector('.timeout');\n      let animTip = document.querySelector('.timeout__tip');\n      animTip.className = 'timeout__tip';\n      bufferAnim.className = 'timeout';\n      animTip.classList.add('timeout__tip_run');\n      bufferAnim.classList.add('timeout_run');\n      animTimer = setTimeout(() => {\n        animTip.classList.remove('timeout__tip_run');\n        bufferAnim.classList.remove('timeout_run');\n      }, SAVED_THIS._timeoutBeforeSearch);\n      // запуск таймера записи буфера\n      bufferTimer = setTimeout(() => {\n        SAVED_THIS.setState(() => buffer);\n        // WARN: нужно ли удалять таймер в конце выполнения?\n        clearTimeout(bufferTimer);\n      }, TIMEOUT_TO_SETSTATE);\n    }\n  }\n  // Проверка (можно ли изменить состояние чекбокса) и возврат всех чекбоксов\n  getCorrectFilters(e) {\n    const FILTERS = this.state.filters;\n    const filterID = e.target.id;\n    // Предотвращение состояния \"все фильтры отключены\"\n    if (FILTERS[filterID] && Object.entries(FILTERS).filter(item => item[0] !== filterID).every(item => !item[1])) {\n      return FILTERS;\n    }\n    // Отключение фильтра \"Все\" в случае клика по любому другому\n    if (FILTERS['all'] && !FILTERS[filterID] && filterID !== 'all') {\n      const st = Object.assign({}, this.state);\n      st.filters['all'] = false;\n      st.filters[filterID] = !st.filters[filterID];\n      return st.filters;\n    }\n    // Отключение всех фильтров в случае клика по \"Все\", кроме него\n    if (filterID === 'all' && Object.values(FILTERS).some(item => item)) {\n      const st = Object.assign({}, this.state);\n      for (let item in st.filters) {\n        if (st.filters.hasOwnProperty(item)) {\n          st.filters[item] = false;\n        }\n      }\n      st.filters['all'] = true;\n      return st.filters;\n    }\n    // Активация фильтров во всех других случаях\n    const st = Object.assign({}, this.state);\n    st.filters[filterID] = !st.filters[filterID];\n    return st.filters;\n  }\n}\n\n// Задача: мгновенный UI-фидбек на клик (переключить CSS-класс)\n// Вопрос: как связать удаление .buffered с обновлением state.filters?\n// вариант 1: передавать delay в this.highlightBuffered\n// вариант 2: props.filters\n// UPD: выбрал 1. Проблемы:  \n// - отдельные таймеры (исчезают не одновременно) \n// - нет отклика на повторный клик. \n// ***Временная подсветка кликнутых чекбоксов***\nfunction highlightBuffered(e, ms) {\n  let watchingCheckbox = e.target;\n  watchingCheckbox.classList.add('buffered');\n  setTimeout(() => { watchingCheckbox.classList.remove('buffered'); }, ms)\n}\n// ***Подсветка активного таба***\nfunction highlightTabs(e) {\n  const cssClass = 'tabs__item_active';\n  if (e.target.classList.contains(cssClass)) {\n    return;\n  } else {\n    e.currentTarget.querySelector('.' + cssClass).classList.remove(cssClass);\n    e.target.classList.add(cssClass);\n  }\n}\n\nReactDOM.render(<App />, document.getElementById('root'))"],"sourceRoot":""}