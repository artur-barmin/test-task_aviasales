(this.webpackJsonpaviasales=this.webpackJsonpaviasales||[]).push([[0],[,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/logo_aviasales.0c089234.svg"},,,function(e,t,n){e.exports=n(24)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(2),s=n(4),i=n(3),c=n(0),o=n.n(c),u=n(10),l=n.n(u),f=(n(19),n(11)),h=n.n(f);function p(){return o.a.createElement("div",{className:"logo center"},o.a.createElement("img",{src:h.a,alt:"",style:{width:"82px"}}))}var m=n(13),v=(n(20),function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s)))._filterText={all:"\u0412\u0441\u0435",0:"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a",1:"1 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430",2:"2 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438",3:"3 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438"},e}return Object(a.a)(n,[{key:"render",value:function(){return o.a.createElement("form",{className:"form filter"},o.a.createElement("h3",{className:"form__header"},"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"),this.renderFilterItems())}},{key:"handleClick",value:function(e){this.highlightBuffered(e,this.props.timeout),this.props.onChange(e)}},{key:"highlightBuffered",value:function(e,t){var n=e.target;n.classList.add("buffered"),setTimeout((function(){n.classList.remove("buffered")}),t)}},{key:"renderFilterItems",value:function(){for(var e=this,t=Object.entries(this.props.filters),n=[],r=0;r<t.length;r+=1){var a=Object(m.a)(t[r],2),s=a[0],i=a[1];n.push(o.a.createElement("div",{className:"filter__item",key:r},o.a.createElement("input",{className:"filter__input",type:"checkbox",id:s,checked:i,onChange:function(t){return e.handleClick(t)}}),o.a.createElement("label",{className:"filter__label",htmlFor:s},this._filterText[s])))}return n}}]),n}(c.Component)),d=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"card row__col-side"},o.a.createElement(v,{filters:this.props.filters,onChange:this.props.onChange,timeout:this.props.timeout}))}}]),n}(c.Component),b=n(12),g=n(5),k=n.n(g),j=n(6),O=(n(22),function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this;return o.a.createElement("ul",{className:"tabs card",onClick:function(t){return e.handleClick(t)}},o.a.createElement("li",{"data-sorter":"cheapest",className:"tabs__item tabs__item_active"},"\u0421\u0430\u043c\u044b\u0439 \u0434\u0435\u0448\u0435\u0432\u044b\u0439"),o.a.createElement("li",{"data-sorter":"fastest",className:"tabs__item"},"\u0421\u0430\u043c\u044b\u0439 \u0431\u044b\u0441\u0442\u0440\u044b\u0439"))}},{key:"handleClick",value:function(e){this.highlight(e),this.props.onClick(e)}},{key:"highlight",value:function(e){var t="tabs__item_active";e.target.classList.contains(t)||(e.currentTarget.querySelector("."+t).classList.remove(t),e.target.classList.add(t))}}]),n}(c.Component)),y=(n(23),function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={details:[]},a}return Object(a.a)(n,[{key:"render",value:function(){return this.state.details.map((function(e,t){return o.a.createElement("div",{key:t,className:"flight row"},o.a.createElement("div",{className:"flight__block"},o.a.createElement("span",{className:"text-grey"},"".concat(e.origin," - ").concat(e.destination)),o.a.createElement("span",{className:"fw-bold"},function(e,t){var n=new Date(e),r=new Date(Date.parse(e)+60*t*1e3),a=n.getHours()<10?"0"+n.getHours():n.getHours(),s=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),i=r.getHours()<10?"0"+r.getHours():r.getHours(),c=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes();return"".concat(a,":").concat(s," - ").concat(i,":").concat(c)}(e.date,e.duration))),o.a.createElement("div",{className:"flight__block"},o.a.createElement("span",{className:"text-grey"},"\u0412 \u043f\u0443\u0442\u0438"),o.a.createElement("span",{className:"fw-bold"},function(e){var t=parseInt(e/60),n=Math.round(60*(e/60-t));return"".concat(t,"\u0447 ").concat(n,"\u043c")}(e.duration))),o.a.createElement("div",{className:"flight__block"},o.a.createElement("span",{className:"text-grey"},function(e){switch(e.length){case 1:return"1 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430";case 2:return"2 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438";case 3:return"3 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0438";default:return"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"}}(e.stops)),o.a.createElement("span",{className:"fw-bold"},e.stops.map((function(e,t){return t>0?", ".concat(e):e})))))}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.details!==t.details&&void 0!==e.details?{details:e.details}:null}}]),n}(c.Component));var E=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={ticketInfo:{}},a}return Object(a.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"card ticket"},o.a.createElement("div",{className:"row row_btwn"},o.a.createElement("span",{className:"price"},"".concat(this.state.ticketInfo.price," \u0420")),o.a.createElement("div",{className:"logo-iata"},o.a.createElement("img",{src:"http://pics.avs.io/99/36/".concat(this.state.ticketInfo.carrier,".png"),alt:this.state.ticketInfo.carrier}))),o.a.createElement(y,{details:this.state.ticketInfo.segments}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.ticketInfo!==t.ticketInfo&&void 0!==e.ticketInfo?{ticketInfo:e.ticketInfo}:null}}]),n}(c.Component),w=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){if(!this.props.ticketsArray)return o.a.createElement("p",{className:"row"},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0431\u0438\u043b\u0435\u0442\u043e\u0432");var e=this.props.ticketsArray.map((function(e,t){return o.a.createElement(E,{ticketInfo:e,key:t})}));return o.a.createElement("div",{className:"tickets"},e)}}]),n}(c.Component),_=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={allowRender:!1,_buf:null},a}return Object(a.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"main row__col-main"},o.a.createElement(O,{onClick:this.props.onClick}),o.a.createElement(w,{ticketsArray:this.state._buf}))}},{key:"componentDidMount",value:function(){var e=Object(j.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.askServer(this.props.sort);case 2:t=e.sent,this.setState((function(e){return{allowRender:!0,_buf:t}}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(j.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===this.props){e.next=6;break}return this.setState((function(){return{allowRender:!1,_buf:null}})),e.next=4,this.askServer(this.props.sort);case 4:n=e.sent,this.setState((function(){return{allowRender:!0,_buf:n}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"askServer",value:function(){var e=Object(j.a)(k.a.mark((function e(){var t,n,r,a,s,i,c,o,u,l,f,h=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:this.props.sort,n=h.length>1&&void 0!==h[1]?h[1]:this.props.filters,r=new URL("https://front-test.beta.aviasales.ru"),a=new URL("/search",r),s=new URL("/tickets?searchId=",r),e.next=7,x(a);case 7:return i=e.sent,c=s+i,console.group("\u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043d\u043e\u0432\u044b\u0435 \u0431\u0438\u043b\u0435\u0442\u044b..."),console.log("search ID: "+i+", URL:",c),e.next=13,C(c);case 13:return o=e.sent,u=[],!0===n.all?u=o:(l=Object.entries(n).filter((function(e){return"all"!==e[0]})).filter((function(e){return!0===e[1]})).map((function(e){return+e[0]})),u=o.filter((function(e){return l.includes(N(e))}))),f="cheapest"===t?M(u):D(u),console.groupEnd(),e.next=20,f;case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(c.Component);function N(e){return Math.max(e.segments[0].stops.length,e.segments[1].stops.length)}function x(e){return fetch(e).then((function(e){return e.json()})).then((function(e){return e.searchId}))}function C(e){return I.apply(this,arguments)}function I(){return(I=Object(j.a)(k.a.mark((function e(t){var n,r,a,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=!1,a=0;case 2:if(!(!0!==r&&a<100)){e.next=13;break}return 100===a&&console.warn("\u0421\u0427\u0415\u0422\u0427\u0418\u041a",a),e.next=6,S(t);case 6:s=e.sent,r=s.stop,n.push.apply(n,Object(b.a)(s.tickets)),r&&console.warn("searching success! stop:",s.stop,", count of tickets:",n.length);case 10:a+=1,e.next=2;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return L.apply(this,arguments)}function L(){return(L=Object(j.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(500!==(n=e.sent).status){e.next=7;break}return e.next=6,S(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,n.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return e.slice().sort((function(e,t){return e.price-t.price})).slice(0,5)}function D(e){return e.slice().sort((function(e,t){return e.segments.reduce((function(e,t){return e.duration+t.duration}))-t.segments.reduce((function(e,t){return e.duration+t.duration}))})).slice(0,5)}var R=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={sort:"cheapest",filters:{all:!0,0:!1,1:!1,2:!1,3:!1},timeoutBeforeSearch:2e3},a}return Object(a.a)(n,[{key:"render",value:function(){var e=this.bufferClicks(this.state.timeoutBeforeSearch);return o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"row"},o.a.createElement(p,null)),o.a.createElement("div",{className:"row"},o.a.createElement(d,{filters:this.state.filters,onChange:e,timeout:this.state.timeoutBeforeSearch}),o.a.createElement(_,{onClick:e,filters:this.state.filters,sort:this.state.sort})))}},{key:"bufferClicks",value:function(e){var t=e,n=this,r=this.state.sort,a=Object.assign({},this.state.filters);return function(e){e.currentTarget.classList.contains("tabs")?r=e.target.dataset.sorter:a=n.getNewFilter(e),setTimeout((function(){n.setState((function(e){var t=Object.assign({},e);return t.sort=r,t.filters=a,t}))}),t)}}},{key:"getNewFilter",value:function(e){var t=e.target.id;if(!0!==this.state.filters[t]||!Object.entries(this.state.filters).filter((function(e){return e[0]!==t})).every((function(e){return!1===e[1]}))){if(!0===this.state.filters.all&&!1===this.state.filters[t]&&"all"!==t){var n=Object.assign({},this.state);return n.filters.all=!1,n.filters[t]=!n.filters[t],n.filters}if("all"===t&&Object.values(this.state.filters).some((function(e){return!0===e}))){var r=Object.assign({},this.state);for(var a in r.filters)r.filters.hasOwnProperty(a)&&(r.filters[a]=!1);return r.filters.all=!0,r.filters}var s=Object.assign({},this.state);return s.filters[t]=!s.filters[t],s.filters}}}]),n}(c.Component);l.a.render(o.a.createElement(R,null),document.getElementById("root"))}],[[14,1,2]]]);
//# sourceMappingURL=main.1299a8c5.chunk.js.map