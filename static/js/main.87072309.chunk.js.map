{"version":3,"sources":["components/Header/logo_aviasales.svg","components/WaitingTimer/index.js","components/Header/index.js","components/Sidebar/Filter/index.js","components/Sidebar/index.js","components/Main/Tabs/index.js","components/Main/TicketList/Ticket/Flight/FlightOrigDest/index.js","components/Main/TicketList/Ticket/Flight/FlightStops/index.js","components/Main/TicketList/Ticket/Flight/FlightDuration/index.js","components/Main/TicketList/Ticket/Flight/index.js","components/Main/TicketList/Ticket/index.js","components/Main/TicketList/Preloader/Preloader.js","components/Main/TicketList/index.js","components/Main/index.js","index.js"],"names":["module","exports","WaintingTimer","className","Header","src","logo","alt","style","width","Filter","props","content","Object","entries","filters","sort","a","map","item","index","filterName","filterStatus","key","type","id","checked","onChange","e","handleClick","htmlFor","renderFilterItems","all","0","1","2","3","Sidebar","Tabs","onClick","data-sorter","FlightStops","segment","origin","destination","timeTakeoff","minutesDuration","start","Date","end","parse","stH","getHours","stM","getMinutes","endH","endM","getTakeoffLandingTime","date","duration","arr","length","describeStops","stops","i","minutes","h","parseInt","m","Math","round","getDuration","Flight","details","Ticket","ticketInfo","price","carrier","segments","Preloader","class","TicketList","ticketsArray","Main","state","tickets","this","getTickets","defaultTicketList","setState","prevProps","newTicketList","URL","hrefEntryAPI","hrefSearchAPI","getSearchID","searchID","console","group","log","loadAllTickets","filterTickets","sortByPrice","sortByDuration","groupEnd","slice","Component","url","fetch","res","json","searchId","store","stop","safeCounter","warn","loadPack","pack","push","searchSessionURL","req","status","activeFilters","neededStops","filter","ticket","includes","max","getMaxStopsOf","b","reduce","prev","App","_timeoutBeforeSearch","handleSearchParams","bufferingDecorator","FILTERS","target","every","st","assign","values","some","hasOwnProperty","context","ms","BUFFER","setStateAfterDelay","rebootableDelayDecorator","updateState","uiBuffer","Set","highlightCheckboxWhileDelay","css_cbON","css_cbOFF","showWaitingTimerWhileDelay","css_runWT","css_stopWT","currentTarget","classList","contains","dataset","sorter","cssClass","querySelector","remove","add","highlightActiveTab","getValidCheckboxes","newState","funcStart","funcEnd","timer","args","clearTimeout","setTimeout","stor","matches","delete","forEach","clear","bufferAnim","document","animTip","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.87072309.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo_aviasales.0c089234.svg\";","import React from 'react'\nimport './style.css'\n\nexport default function WaintingTimer() {\n  return (\n    <>\n      <p className=\"timeout__tip\">Ожидание ввода...</p>\n      <div className='timeout'></div>\n    </>\n  );\n}","import React from 'react'\nimport logo from './logo_aviasales.svg'\n\nexport default function Header() {\n  return (\n    <div className=\"logo center\">\n      <img src={logo} alt='Aviasales logo' style={{ width: '82px' }} />\n    </div>\n  );\n}","import React from 'react'\nimport './style.css'\n\nexport default function Filter(props) {\n  // WARN: лучше использовать i18n-либы\n  const _filterText = {\n    all: 'Все',\n    0: 'Без пересадок',\n    1: '1 пересадка',\n    2: '2 пересадки',\n    3: '3 пересадки'\n  }\n  return (\n    <form className=\"form filter\">\n      <h3 className=\"form__header\">Количество пересадок</h3>\n      {renderFilterItems(props, _filterText)}\n    </form>\n  );\n}\nfunction renderFilterItems(props, content) {\n  // Сортировка нужна из-за перемешивания движком строковых полей объекта App.state.filters\n  // WARN: вариант без сортировки?\n  const FILTER_RAW = Object.entries(props.filters).sort(a => -(a[0] === 'all'));\n  return FILTER_RAW.map((item, index) => {\n    const [filterName, filterStatus] = item;\n    return (\n      <div className=\"filter__item\" key={index}>\n        <input className=\"filter__input\" type=\"checkbox\"\n          id={filterName}\n          checked={filterStatus}\n          onChange={(e) => handleClick(e, props)}\n        />\n        <label className=\"filter__label\" htmlFor={filterName}>\n          {content[filterName]}\n        </label>\n      </div>\n    )\n  })\n}\nfunction handleClick(e, props) {\n  props.onChange(e);\n}","import React from 'react'\nimport Filter from './Filter'\n\nexport default function Sidebar(props) {\n  return (\n    <div className=\"card row__col-side\">\n      <Filter\n        filters={props.filters}\n        onChange={props.onChange}\n      />\n    </div>\n  );\n}","import React from 'react'\nimport './style.css'\n\nexport default function Tabs(props) {\n  return (\n    <ul className=\"tabs card\" onClick={(e) => handleClick(e, props)}>\n      <li data-sorter=\"cheapest\" className=\"tabs__item tabs__item_active\">Самый дешевый</li>\n      <li data-sorter=\"fastest\" className=\"tabs__item\">Самый быстрый</li>\n    </ul>\n  );\n}\nfunction handleClick(e, props) {\n  props.onClick(e);\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">\n        {`${props.segment.origin} - ${props.segment.destination}`}\n      </span>\n      <span className=\"fw-bold\">\n        {getTakeoffLandingTime(props.segment.date, props.segment.duration)}\n      </span>\n    </div>\n  );\n}\nfunction getTakeoffLandingTime(timeTakeoff, minutesDuration) {\n  const start = new Date(timeTakeoff);\n  const end = new Date(Date.parse(timeTakeoff) + minutesDuration * 60 * 1000);\n\n  const stH = start.getHours()    < 10 ? '0' + start.getHours()   : start.getHours();\n  const stM = start.getMinutes()  < 10 ? '0' + start.getMinutes() : start.getMinutes();\n  const endH = end.getHours()     < 10 ? '0' + end.getHours()     : end.getHours();\n  const endM = end.getMinutes()   < 10 ? '0' + end.getMinutes()   : end.getMinutes();\n\n  return `${stH}:${stM} - ${endH}:${endM}`;\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">\n        {describeStops(props.stops)}\n      </span>\n      <span className=\"fw-bold\">\n        {props.stops.map((item, i) => i > 0 ? ', '+item : item)}\n      </span>\n    </div>\n  );\n}\nfunction describeStops(arr) {\n  switch (arr.length) {\n    case 1: return '1 пересадка';\n    case 2: return '2 пересадки';\n    case 3: return '3 пересадки';\n    default: return 'Без пересадок';\n  }\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">В пути</span>\n      <span className=\"fw-bold\">\n        {getDuration(props.duration)}\n      </span>\n    </div>\n  );\n}\nfunction getDuration(minutes) {\n  const h = parseInt(minutes / 60);\n  const m = Math.round((minutes / 60 - h) * 60);\n  return `${h}ч ${m}м`;\n}","import React from 'react'\nimport FlightOrigDest from './FlightOrigDest'\nimport FlightStops from './FlightStops'\nimport FlightDuration from './FlightDuration'\n\nexport default function Flight(props) {\n  return props.details.map((segment, i) => {\n    return (\n      <div key={i} className=\"flight row\">\n        <FlightOrigDest segment={segment} />\n        <FlightDuration duration={segment.duration} />\n        <FlightStops stops={segment.stops} />\n      </div>\n    );\n  })\n}","import React from 'react';\nimport './style.css';\nimport Flight from './Flight'\n\nexport default function Ticket(props) {\n  return (\n    <div className=\"card ticket\">\n      <div className=\"row row_btwn\">\n        <span className=\"price\">\n          {props.ticketInfo.price} Р\n          </span>\n        <div className=\"logo-iata\">\n          <img\n            src={`http://pics.avs.io/99/36/${props.ticketInfo.carrier}.png`}\n            alt={props.ticketInfo.carrier} />\n        </div>\n      </div>\n      <Flight details={props.ticketInfo.segments} />\n    </div>\n  );\n}","import React from 'react'\nimport './Preloader.css'\n\nexport default function Preloader() {\n  return (\n    <div className=\"row preloader__wrapper\">\n      <p className='preloader__descr'>Подождите, загружаем новые билеты</p>\n      <div class=\"cssload-container\">\n        <div class=\"cssload-speeding-wheel\"></div>\n      </div>\n    </div>\n  )\n}","import React from 'react'\nimport Ticket from './Ticket'\nimport Preloader from './Preloader/Preloader'\n\nexport default function TicketList(props) {\n  if (!props.ticketsArray) {\n    return <Preloader />\n  }\n  return (\n    <div className='tickets'>\n      {props.ticketsArray.map((item, i) => <Ticket ticketInfo={item} key={i} />)}\n    </div>\n  );\n\n}","import React, { Component } from 'react'\n\nimport Tabs from './Tabs'\nimport TicketList from './TicketList'\n\nexport default class Main extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      tickets: null\n    }\n  }\n  render() {\n    return (\n      <div className=\"main row__col-main\">\n        <Tabs\n          onClick={this.props.onClick}\n        />\n        <TicketList\n          ticketsArray={this.state.tickets}\n        />\n      </div>\n    )\n  }\n  async componentDidMount() {\n    const defaultTicketList = await this.getTickets();\n    this.setState({ tickets: defaultTicketList })\n  }\n  async componentDidUpdate(prevProps) {\n    if (prevProps !== this.props) {\n      this.setState({ tickets: null })\n      const newTicketList = await this.getTickets();\n      this.setState({ tickets: newTicketList })\n    }\n  }\n  async getTickets(sort = this.props.sort, filters = this.props.filters) {\n    const origin = new URL('https://front-test.beta.aviasales.ru');\n    const hrefEntryAPI = new URL('/search', origin);\n    const hrefSearchAPI = new URL('/tickets?searchId=', origin);\n\n    const searchID = await getSearchID(hrefEntryAPI);\n\n    console.group('получаем новые билеты...');\n    console.log('searchID: ' + searchID + ', URL:', hrefSearchAPI + searchID);\n\n    let tickets = await loadAllTickets(hrefSearchAPI + searchID);\n    tickets = filterTickets(tickets, filters);\n    tickets = (sort === \"cheapest\" ? sortByPrice : sortByDuration)(tickets);\n\n    console.groupEnd();\n\n    return tickets.slice(0, 5);\n  }\n}\n\n// --------------------------------------\nasync function getSearchID(url) {\n  const res = await fetch(url);\n  const json = await res.json();\n  return json.searchId;\n}\nasync function loadAllTickets(url) {\n  const store = [];\n  for (let stop = false, safeCounter = 0; stop !== true && safeCounter < 100; safeCounter += 1) {\n    // на случай infinite loop, несколько раз приходилось hard reset\n    if (safeCounter >= 90) { console.warn('превышение кол-ва запросов, осталось', 100 - safeCounter) }\n    const pack = await loadPack(url);\n    stop = pack.stop;\n    store.push(...pack.tickets);\n    if (stop) {\n      console.log('поиск завершен! stop:', pack.stop, ', count of tickets:', store.length);\n    }\n  }\n  return store;\n}\nasync function loadPack(searchSessionURL) {\n  const req = await fetch(searchSessionURL);\n  if (req.status === 500) {\n    return await loadPack(searchSessionURL);\n  }\n  return await req.json();\n}\n\n// --------------------------------------\nfunction filterTickets(tickets, activeFilters) {\n  // Критерий: наибольшее число пересадок (по любому из направлений) соотв-ет активному фильтру\n  // WARN: если активны все 4, то лишняя обработка, т.к 4 фильтра === 1 фильтр 'all'\n  if (activeFilters['all']) {\n    return tickets;\n  }\n  const neededStops = Object.entries(activeFilters).filter(item => item[1]).map(item => +item[0]);\n  return tickets.filter(ticket => neededStops.includes(getMaxStopsOf(ticket)));\n}\nfunction getMaxStopsOf(ticket) {\n  return Math.max(ticket.segments[0].stops.length, ticket.segments[1].stops.length);\n}\n\nfunction sortByPrice(tickets) {\n  return tickets\n    .slice()\n    .sort((a, b) => a.price - b.price);\n}\nfunction sortByDuration(tickets) {\n  return tickets\n    .slice()\n    .sort((a, b) => {\n      return a.segments.reduce((prev, item) => prev.duration + item.duration)\n        -\n        b.segments.reduce((prev, item) => prev.duration + item.duration);\n    });\n}\n\n\n\n\n","import React, { Component } from 'react'\nimport ReactDOM from 'react-dom'\nimport './style.css'\nimport WaitingTimer from './components/WaitingTimer'\nimport Header from './components/Header'\nimport Sidebar from './components/Sidebar'\nimport Main from './components/Main'\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      sort: \"cheapest\",\n      filters: { all: true, 0: false, 1: false, 2: false, 3: false },\n    }\n  }\n  _timeoutBeforeSearch = 2000;\n  render() {\n    // Буферизация кликов перед установкой стейта (и последующим запросом билетов)\n    let handleSearchParams = bufferingDecorator(this, this._timeoutBeforeSearch);\n\n    return (\n      <div className='container'>\n        <WaitingTimer />\n        <div className=\"row\">\n          <Header />\n        </div>\n        <div className=\"row\">\n          <Sidebar\n            filters={this.state.filters}\n            onChange={handleSearchParams}\n          />\n          <Main\n            onClick={handleSearchParams}\n            filters={this.state.filters}\n            sort={this.state.sort}\n          />\n        </div>\n      </div>\n    )\n  }\n  // Проверка \"можно ли изменить состояние фильтра\" тк частично исключают друг друга\n  getValidCheckboxes(e) {\n    const FILTERS = this.state.filters;\n    const id = e.target.id;\n    // Предотвращение состояния \"все фильтры отключены\"\n    if (FILTERS[id] && Object.entries(FILTERS).filter(item => item[0] !== id).every(item => !item[1])) {\n      return FILTERS;\n    }\n    // Отключение фильтра \"Все\" в случае клика по любому другому\n    if (FILTERS['all'] && !FILTERS[id] && id !== 'all') {\n      const st = Object.assign({}, this.state);\n      st.filters['all'] = false;\n      st.filters[id] = !st.filters[id];\n      return st.filters;\n    }\n    // Отключение всех фильтров в случае клика по \"Все\", кроме него\n    if (id === 'all' && Object.values(FILTERS).some(item => item)) {\n      const st = Object.assign({}, this.state);\n      for (let item in st.filters) {\n        if (st.filters.hasOwnProperty(item)) {\n          st.filters[item] = false;\n        }\n      }\n      st.filters['all'] = true;\n      return st.filters;\n    }\n    // Активация фильтров во всех других случаях\n    const st = Object.assign({}, this.state);\n    st.filters[id] = !st.filters[id];\n    return st.filters;\n  }\n}\n\n// Буферизация кликов перед установкой стейта (и последующим запросом билетов)\n// Зачем: плохо дёргать сервер на каждое движение юзера\n// Способ: замыкания. Не повторять, ну нафиг, лучше state / shouldUpdate / ref\nconst bufferingDecorator = (context, ms) => {\n\n  // Буфер состояния контролов для setState\n  const BUFFER = Object.assign({}, context.state);\n  const setStateAfterDelay = rebootableDelayDecorator(ms, null, updateState);\n\n  // WARN: отрефакторить. Буфер только чекбоксов и только для переключения\n  // CSS-класса (не вариант checked=true, тк инпуты управляемые)\n  const uiBuffer = new Set();\n  const highlightCheckboxWhileDelay = rebootableDelayDecorator(ms, css_cbON, css_cbOFF);\n  // ---------------\n\n  // Бегущая строка вверху экрана\n  const showWaitingTimerWhileDelay = rebootableDelayDecorator(ms, css_runWT, css_stopWT);\n\n  return (e) => {\n    // Сохранение в буфер состояния контролов на момент последнего клика\n    if (e.currentTarget.classList.contains('tabs')) {\n      BUFFER.sort = e.target.dataset.sorter;\n      highlightActiveTab(e);\n    } else {\n      BUFFER.filters = context.getValidCheckboxes(e);\n    }\n    // запуск таймера и анимации перед записью буфера в стейт\n    showWaitingTimerWhileDelay();\n    highlightCheckboxWhileDelay(uiBuffer, e);\n    setStateAfterDelay(context, BUFFER);\n  }\n}\n// хелпер для извлеченного метода bufferingDecorator\nfunction updateState(context, newState) {\n  context.setState(() => newState);\n}\n// обеспечивает продлевающуюся задержку\nfunction rebootableDelayDecorator(ms, funcStart, funcEnd) {\n  let timer;\n  return (...args) => {\n    clearTimeout(timer);\n    if (funcStart) {\n      funcStart(...args);\n    }\n    timer = setTimeout(() => {\n      funcEnd(...args);\n      clearTimeout(timer);\n    }, ms);\n  }\n}\n\n// ***Подсветка кликнутых чекбоксов while delay***\n// Задача: мгновенный UI-фидбек на клик (переключить CSS-класс)\n// Проблема: это управляемый компонент\n// Как связать удаление .buffered с обновлением state.filters?\n// вариант 1: передавать delay в highlightFilterWhileDelay\n// вариант 2: props.filters\n// UPD: выбрал 1й вариант, WARNING: рассинхрон с getValidCheckboxes\nfunction css_cbON(stor, e) {\n  const cssClass = 'buffered';\n  if (e.target.matches('.' + cssClass)) {\n    stor.delete(e.target);\n    e.target.classList.remove(cssClass);\n  } else {\n    stor.add(e.target);\n    e.target.classList.add(cssClass);\n  }\n}\nfunction css_cbOFF(store) {\n  const cssClass = 'buffered';\n  store.forEach(item => item.classList.remove(cssClass));\n  store.clear();\n}\n\n// *** Бегущая строка в верху экрана ***\nfunction css_runWT() {\n  const bufferAnim = document.querySelector('.timeout');\n  const animTip = document.querySelector('.timeout__tip');\n  animTip.className = 'timeout__tip';\n  bufferAnim.className = 'timeout';\n  animTip.classList.add('timeout__tip_run');\n  bufferAnim.classList.add('timeout_run');\n}\nfunction css_stopWT() {\n  const bufferAnim = document.querySelector('.timeout');\n  const animTip = document.querySelector('.timeout__tip');\n  animTip.classList.remove('timeout__tip_run');\n  bufferAnim.classList.remove('timeout_run');\n}\n\n// ***Подсветка активного таба***\nfunction highlightActiveTab(e) {\n  const cssClass = 'tabs__item_active';\n  if (e.target.classList.contains(cssClass)) {\n    return;\n  } else {\n    e.currentTarget.querySelector('.' + cssClass).classList.remove(cssClass);\n    e.target.classList.add(cssClass);\n  }\n}\n\nReactDOM.render(<App />, document.getElementById('root'))"],"sourceRoot":""}