{"version":3,"sources":["components/Header/logo_aviasales.svg","components/WaitingTimer/index.js","components/Header/index.js","components/Sidebar/Filter/FIlterItem/index.js","components/Sidebar/Filter/index.js","components/Sidebar/index.js","components/Main/Tabs/index.js","components/Main/TicketList/Ticket/Flight/FlightOrigDest/index.js","components/Main/TicketList/Ticket/Flight/FlightStops/index.js","components/Main/TicketList/Ticket/Flight/FlightDuration/index.js","components/Main/TicketList/Ticket/Flight/index.js","components/Main/TicketList/Ticket/index.js","components/Main/TicketList/Preloader/index.js","components/Main/TicketList/index.js","components/Main/processingTickets/filterTickets.js","components/Main/processingTickets/sortTickets.js","components/Main/processingTickets/index.js","components/Main/index.js","components/UI/effects.js","components/UI/validation.js","components/UI/handlers.js","index.js"],"names":["module","exports","WaintingTimer","className","Header","src","logo","alt","style","width","FilterItem","props","filter","filterName","filterStatus","labelText","key","type","id","checked","onChange","e","htmlFor","Filter","_filterText","all","0","1","2","3","filters","Object","entries","sort","a","map","item","push","Sidebar","Tabs","onClick","data-sorter","FlightStops","segment","origin","destination","timeTakeoff","minutesDuration","start","Date","end","parse","stH","getHours","stM","getMinutes","endH","endM","getTakeoffLandingTime","date","duration","arr","length","describeStops","stops","i","minutes","h","parseInt","m","Math","round","getDuration","Flight","details","Ticket","ticketInfo","price","carrier","segments","Preloader","xmlns","margin","background","display","shapeRendering","height","viewBox","preserveAspectRatio","cx","cy","r","stroke-width","stroke","stroke-dasharray","fill","stroke-linecap","transform","attributeName","repeatCount","dur","keyTimes","values","TicketList","ticketsArray","filterTickets","tickets","activeFilters","neededStops","ticket","includes","max","getMaxStopsOf","sortByDuration","slice","b","reduce","prev","sortByPrice","getTickets","getSearchID","searchID","console","group","loadAllTickets","groupEnd","url","fetch","res","json","searchId","store","isStopped","safeCounter","loadPack","pack","stop","log","warn","searchSessionURL","req","status","Main","state","this","defaultTicketList","setState","prevProps","newTicketList","Component","highlightCheckboxOn","stor","target","matches","delete","classList","remove","add","highlightCheckboxOff","forEach","clear","runWaitingTimer","bufferAnim","document","querySelector","animTip","stopWaitingTimer","getValidCheckboxes","FILTERS","every","st","assign","some","hasOwnProperty","bufferingDecorator","context","ms","BUFFER","setStateAfterDelay","rebootableDelayDecorator","updateState","bufferForUI","Set","showVisualFeedback","UI","currentTarget","contains","dataset","sorter","cssClass","call","functionsStart","functionsEnd","timer","args","clearTimeout","func","setTimeout","newState","App","_timeoutBeforeSearch","handleSearchParams","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.50a2e18d.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo_aviasales.0c089234.svg\";","import React from 'react'\nimport './style.css'\n\nexport default function WaintingTimer() {\n  return (\n    <>\n      <p className=\"timeout__tip\">Хотите добавить параметры поиска?</p>\n      <div className='timeout'></div>\n    </>\n  );\n}","import React from 'react'\nimport logo from './logo_aviasales.svg'\n\nexport default function Header() {\n  return (\n    <div className=\"logo center\">\n      <img src={logo} alt='Aviasales logo' style={{ width: '82px' }} />\n    </div>\n  );\n}","import React from 'react';\n\nfunction FilterItem(props) {\n  const [ filterName, filterStatus, labelText ] = props.filter;\n  return (\n    <div className=\"filter__item\" key={filterName}>\n        <input className=\"filter__input\" type=\"checkbox\"\n          id={filterName}\n          checked={filterStatus}\n          onChange={(e) => props.onChange(e)}\n        />\n        <label className=\"filter__label\" htmlFor={filterName}>\n          {labelText}\n        </label>\n      </div>\n  );\n}\n\nexport default FilterItem;","import React from 'react'\nimport './style.css'\nimport FilterItem from './FIlterItem'\n\nexport default function Filter(props) {\n  // TODO: использовать i18n-либы\n  const _filterText = {\n    all: 'Все',\n    0: 'Без пересадок',\n    1: '1 пересадка',\n    2: '2 пересадки',\n    3: '3 пересадки'\n  }\n\n  // Для вывода \"Все\" наверху (props.filters сортируется движком по лексиграф. порядку)\n  const filters = Object.entries(props.filters).sort(a => -(a[0] === 'all'));\n  // Для передачи текста label в едином пропсе FilterItem\n  filters.map(item => item.push(_filterText[item[0]]));\n\n  return (\n    <form className=\"form filter\">\n      <h3 className=\"form__header\">Количество пересадок</h3>\n      {filters.map(item => {\n        return <FilterItem filter={item} onChange={(e) => props.onChange(e)} />\n      })}\n    </form>\n  );\n}","import React from 'react'\nimport Filter from './Filter'\n\nexport default function Sidebar(props) {\n  return (\n    <div className=\"card row__col-side\">\n      <Filter\n        filters={props.filters}\n        onChange={props.onChange}\n      />\n    </div>\n  );\n}","import React from 'react'\nimport './style.css'\n\nexport default function Tabs(props) {\n  return (\n    <ul className=\"tabs card\" onClick={(e) => props.onClick(e)}>\n      <li data-sorter=\"cheapest\" className=\"tabs__item tabs__item_active\">Самый дешевый</li>\n      <li data-sorter=\"fastest\" className=\"tabs__item\">Самый быстрый</li>\n    </ul>\n  );\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">\n        {`${props.segment.origin} - ${props.segment.destination}`}\n      </span>\n      <span className=\"fw-bold\">\n        {getTakeoffLandingTime(props.segment.date, props.segment.duration)}\n      </span>\n    </div>\n  );\n}\nfunction getTakeoffLandingTime(timeTakeoff, minutesDuration) {\n  const start = new Date(timeTakeoff);\n  const end = new Date(Date.parse(timeTakeoff) + minutesDuration * 60 * 1000);\n\n  const stH = start.getHours()    < 10 ? '0' + start.getHours()   : start.getHours();\n  const stM = start.getMinutes()  < 10 ? '0' + start.getMinutes() : start.getMinutes();\n  const endH = end.getHours()     < 10 ? '0' + end.getHours()     : end.getHours();\n  const endM = end.getMinutes()   < 10 ? '0' + end.getMinutes()   : end.getMinutes();\n\n  return `${stH}:${stM} - ${endH}:${endM}`;\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">\n        {describeStops(props.stops)}\n      </span>\n      <span className=\"fw-bold\">\n        {props.stops.map((item, i) => i > 0 ? ', '+item : item)}\n      </span>\n    </div>\n  );\n}\nfunction describeStops(arr) {\n  switch (arr.length) {\n    case 1: return '1 пересадка';\n    case 2: return '2 пересадки';\n    case 3: return '3 пересадки';\n    default: return 'Без пересадок';\n  }\n}","import React from 'react'\n\nexport default function FlightStops(props) {\n  return (\n    <div className=\"flight__block\">\n      <span className=\"text-grey\">В пути</span>\n      <span className=\"fw-bold\">\n        {getDuration(props.duration)}\n      </span>\n    </div>\n  );\n}\nfunction getDuration(minutes) {\n  const h = parseInt(minutes / 60);\n  const m = Math.round((minutes / 60 - h) * 60);\n  return `${h}ч ${m}м`;\n}","import React from 'react'\nimport FlightOrigDest from './FlightOrigDest'\nimport FlightStops from './FlightStops'\nimport FlightDuration from './FlightDuration'\n\nexport default function Flight(props) {\n  return props.details.map((segment, i) => {\n    return (\n      <div key={i} className=\"flight row\">\n        <FlightOrigDest segment={segment} />\n        <FlightDuration duration={segment.duration} />\n        <FlightStops stops={segment.stops} />\n      </div>\n    );\n  })\n}","import React from 'react';\nimport './style.css';\nimport Flight from './Flight'\n\nexport default function Ticket(props) {\n  return (\n    <div className=\"card ticket\">\n      <div className=\"row row_btwn\">\n        <span className=\"price\">\n          {props.ticketInfo.price} Р\n          </span>\n        <div className=\"logo-iata\">\n          <img\n            src={`http://pics.avs.io/99/36/${props.ticketInfo.carrier}.png`}\n            alt={props.ticketInfo.carrier} />\n        </div>\n      </div>\n      <Flight details={props.ticketInfo.segments} />\n    </div>\n  );\n}","import React from 'react'\nimport './style.css'\n\nexport default function Preloader() {\n  return (\n    <div className=\"row preloader__wrapper\">\n      <p className='preloader__descr'>Подождите, загружаем новые билеты</p>\n      <svg xmlns=\"http://www.w3.org/2000/svg\" style={{ margin: 'auto', background: 'rgba(241, 242, 243, 0)', display: 'block', shapeRendering: 'auto' }} width=\"100px\" height=\"100px\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\">\n        <circle cx=\"50\" cy=\"50\" r=\"32\" stroke-width=\"2\" stroke=\"#2196f3\" stroke-dasharray=\"50.26548245743669 50.26548245743669\" fill=\"none\" stroke-linecap=\"round\" transform=\"rotate(140.358 50 50)\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\" repeatCount=\"indefinite\" dur=\"0.564102564102564s\" keyTimes=\"0;1\" values=\"0 50 50;360 50 50\"></animateTransform>\n        </circle>\n      </svg>\n    </div>\n  )\n}","import React from 'react'\nimport Ticket from './Ticket'\nimport Preloader from './Preloader'\n\nexport default function TicketList(props) {\n  if (!props.ticketsArray) {\n    return <Preloader />\n  }\n  return (\n    <div className='tickets'>\n      {props.ticketsArray.map((item, i) => <Ticket ticketInfo={item} key={i} />)}\n    </div>\n  );\n\n}","// Критерий фильтра: \n// используется наибольшее (из двух направлений) количество пересадок\n\nexport default function filterTickets(tickets, activeFilters) {\n  if (activeFilters['all']) {\n    return tickets;\n  }\n  const neededStops = Object.entries(activeFilters)\n    .filter(item => item[1])\n    .map(item => +item[0]);\n\n  return tickets.filter(ticket => neededStops.includes(getMaxStopsOf(ticket)));\n}\n\nfunction getMaxStopsOf(ticket) {\n  return Math.max(ticket.segments[0].stops.length, ticket.segments[1].stops.length);\n}","// Критерий сортировки byDuration: \n// исп-ся суммарная длительность in air в обоих направлениях\n\nexport function sortByDuration(tickets) {\n  return tickets\n    .slice()\n    .sort((a, b) => {\n      const firstTicketTotalDuration = a.segments.reduce((prev, item) => prev.duration + item.duration);\n      const secondTicketTotalDuration = b.segments.reduce((prev, item) => prev.duration + item.duration);\n      // Тоже самое: b.segments[0].duration + b.segments[1].duration\n      // Array.prototype.reduce() на случай, если однажды в билетах вдруг станет больше 2-х полётов.\n      return firstTicketTotalDuration - secondTicketTotalDuration;\n    });\n}\n\nexport function sortByPrice(tickets) {\n  return tickets\n    .slice()\n    .sort((a, b) => a.price - b.price);\n}","import filterTickets from './filterTickets'\nimport { sortByDuration, sortByPrice } from './sortTickets'\n\nexport default async function getTickets(sort, filters) {\n  const searchID = await getSearchID('https://front-test.beta.aviasales.ru/search');\n\n  console.group('получаем билеты, searchID:', searchID);\n\n  let tickets = await loadAllTickets('https://front-test.beta.aviasales.ru/tickets?searchId=' + searchID);\n  tickets = filterTickets(tickets, filters);\n  tickets = (sort === \"cheapest\" ? sortByPrice : sortByDuration)(tickets);\n\n  console.groupEnd();\n\n  // Для тестового задания достаточно вывода 5 билетов\n  return tickets.slice(0, 5);\n}\n\nasync function getSearchID(url) {\n  const res = await fetch(url);\n  const json = await res.json();\n  return json.searchId;\n}\n\nasync function loadAllTickets(url) {\n  const store = [];\n  let isStopped = false;\n  // предохранитель от бесконечного цикла на случай неправильной работы сервера\n  let safeCounter = 0;\n  while (!isStopped) {\n    const pack = await loadPack(url);\n    isStopped = pack.stop;\n    store.push(...pack.tickets);\n    if (isStopped) {\n      console.log('поиск завершен! stop:', pack.stop, ', count of tickets:', store.length);\n    }\n    if (safeCounter >= 100) {\n      console.warn('Непредвиденное превышение кол-ва запросов, завершение поиска');\n      isStopped = true;\n    }\n    safeCounter += 1;\n  }\n  return store;\n}\n\nasync function loadPack(searchSessionURL) {\n  const req = await fetch(searchSessionURL);\n  // Сервер периодически симулирует ошибки с конкретно 500-м кодом\n  if (req.status === 500) {\n    return await loadPack(searchSessionURL);\n  }\n  return await req.json();\n}","import React, { Component } from 'react'\nimport Tabs from './Tabs'\nimport TicketList from './TicketList'\nimport getTickets from './processingTickets'\n\nexport default class Main extends Component {\n  state = {\n    tickets: null\n  }\n  render() {\n    return (\n      <div className=\"main row__col-main\">\n        <Tabs onClick={this.props.onClick} />\n        <TicketList ticketsArray={this.state.tickets} />\n      </div>\n    )\n  }\n  async componentDidMount() {\n    const defaultTicketList = await getTickets(this.props.sort, this.props.filters);\n    this.setState({ tickets: defaultTicketList });\n  }\n  async componentDidUpdate(prevProps) {\n    if (prevProps !== this.props) {\n      this.setState({ tickets: null });\n      const newTicketList = await getTickets(this.props.sort, this.props.filters);\n      this.setState({ tickets: newTicketList });\n    }\n  }\n}","// *** DELAYED: Подсветка кликнутых чекбоксов ***\n// Задача: мгновенный UI-фидбек на клик (переключить CSS-класс)\n// Проблема: это управляемый компонент\n// Как связать удаление класса .buffered с обновлением state.filters?\n// вариант 1: передавать delay в highlightFilterWhileDelay\n// вариант 2: props.filters\n// UPD: выбрал 1й вариант\nexport function highlightCheckboxOn(stor, e) {\n  const cssClass = 'buffered';\n  if (e.target.matches('.' + cssClass)) {\n    stor.delete(e.target);\n    e.target.classList.remove(cssClass);\n  } else {\n    stor.add(e.target);\n    e.target.classList.add(cssClass);\n  }\n}\nexport function highlightCheckboxOff(store) {\n  const cssClass = 'buffered';\n  store.forEach(item => item.classList.remove(cssClass));\n  store.clear();\n}\n\n// *** DELAYED: бегущая строка в верху экрана ***\nexport function runWaitingTimer() {\n  const bufferAnim = document.querySelector('.timeout');\n  const animTip = document.querySelector('.timeout__tip');\n  animTip.className = 'timeout__tip';\n  bufferAnim.className = 'timeout';\n  animTip.classList.add('timeout__tip_run');\n  bufferAnim.classList.add('timeout_run');\n}\nexport function stopWaitingTimer() {\n  const bufferAnim = document.querySelector('.timeout');\n  const animTip = document.querySelector('.timeout__tip');\n  animTip.classList.remove('timeout__tip_run');\n  bufferAnim.classList.remove('timeout_run');\n}\n\n// *** not delayed. Выделение выбранной сортировки ***\nexport function highlightActiveTab(e) {\n  const cssClass = 'tabs__item_active';\n  if (e.target.classList.contains(cssClass)) {\n    return;\n  } else {\n    e.currentTarget.querySelector('.' + cssClass).classList.remove(cssClass);\n    e.target.classList.add(cssClass);\n  }\n}","// Проверка \"можно ли изменить состояние фильтра\" тк частично исключают друг друга\nexport default function getValidCheckboxes(e) {\n  const FILTERS = this.state.filters;\n  const id = e.target.id;\n\n  // Предотвращение состояния \"все фильтры отключены\"\n  if (FILTERS[id] && Object.entries(FILTERS).filter(item => item[0] !== id).every(item => !item[1])) {\n    return FILTERS;\n  }\n\n  // Отключение фильтра \"Все\" в случае клика по любому другому\n  if (FILTERS['all'] && !FILTERS[id] && id !== 'all') {\n    const st = Object.assign({}, this.state);\n    st.filters['all'] = false;\n    st.filters[id] = !st.filters[id];\n    return st.filters;\n  }\n\n  // Отключение всех фильтров в случае клика по \"Все\", кроме него\n  if (id === 'all' && Object.values(FILTERS).some(item => item)) {\n    const st = Object.assign({}, this.state);\n    for (let item in st.filters) {\n      if (st.filters.hasOwnProperty(item)) {\n        st.filters[item] = false;\n      }\n    }\n    st.filters['all'] = true;\n    return st.filters;\n  }\n\n  // Активация фильтров во всех других случаях\n  const st = Object.assign({}, this.state);\n  st.filters[id] = !st.filters[id];\n  return st.filters;\n}","import * as UI from './effects'\nimport getValidCheckboxes from './validation'\n\nexport default function bufferingDecorator(context, ms) {\n  // *Буфер сохраняет желаемые параметры поиска\n  const BUFFER = Object.assign({}, context.state);\n  const setStateAfterDelay = rebootableDelayDecorator(ms, [], [updateState]);\n\n  // *Визуальная обратная связь для юзера на время таймаута\n  // Set используется в UI.highlightCheckboxOn/Off: обработка UI отделена от состояния контролов,\n  // т.к. завязаться на стейт не вариант - есть таймаут, а обратную связь надо сразу\n  const bufferForUI = new Set();\n  const showVisualFeedback = rebootableDelayDecorator(\n    ms,\n    [UI.highlightCheckboxOn, UI.runWaitingTimer],\n    [UI.highlightCheckboxOff, UI.stopWaitingTimer]\n  );\n\n  return (e) => {\n    // Сохранение состояния контролов на момент ПОСЛЕДНЕГО клика\n    if (e.currentTarget.classList.contains('tabs')) {\n      BUFFER.sort = e.target.dataset.sorter;\n      UI.highlightActiveTab(e);\n    } else {\n      BUFFER.filters = getValidCheckboxes.call(context, e);\n    }\n    showVisualFeedback(bufferForUI, e);\n    setStateAfterDelay(context, BUFFER);\n  }\n}\n\n// после каждого клика перезапускает время для анимаций и setState\nconst rebootableDelayDecorator = (ms, functionsStart, functionsEnd) => {\n  let timer;\n  return (...args) => {\n    clearTimeout(timer);\n    if (functionsStart.length > 0) {\n      functionsStart.forEach(func => func(...args));\n    }\n    timer = setTimeout(() => {\n      functionsEnd.forEach(func => func(...args));\n      clearTimeout(timer);\n    }, ms);\n  }\n}\n// хелпер для передачи контекста bufferingDecorator\nconst updateState = (context, newState) => {\n  context.setState(() => newState);\n}","import React, { Component } from 'react'\nimport ReactDOM from 'react-dom'\nimport './style.css'\nimport WaitingTimer from './components/WaitingTimer'\nimport Header from './components/Header'\nimport Sidebar from './components/Sidebar'\nimport Main from './components/Main'\nimport bufferingDecorator from './components/UI/handlers'\n\nclass App extends Component {\n  state = {\n    sort: \"cheapest\",\n    filters: {\n      all: true,\n      0: false,\n      1: false,\n      2: false,\n      3: false\n    },\n  }\n  _timeoutBeforeSearch = 2000;\n\n  render() {\n    // Дает время пользователю кликнуть нужные параметры поиска перед\n    // 1. записью нового состояния контролов в стейт\n    // 2. последующим запросом билетов (используется Main.componentDidUpdate)\n    // Зачем: чтобы не дергать сервер после каждого движения юзера\n    const handleSearchParams = bufferingDecorator(this, this._timeoutBeforeSearch);\n    return (\n      <div className='container'>\n        <WaitingTimer />\n        <div className=\"row\">\n          <Header />\n        </div>\n        <div className=\"row\">\n          <Sidebar\n            filters={this.state.filters}\n            onChange={handleSearchParams}\n          />\n          <Main\n            onClick={handleSearchParams}\n            filters={this.state.filters}\n            sort={this.state.sort}\n          />\n        </div>\n      </div>\n    )\n  }\n}\n\nReactDOM.render(<App />, document.getElementById('root'))"],"sourceRoot":""}